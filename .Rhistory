################################
# I6 model
################################
model_I6_common <- glm(as.formula((paste("RFS_c3 ~", paste(I20common, collapse = "+")))), data = Data_c3, family = "binomial")
save(model_I6_common, file = './objs/model_I6_common_appOnTHR50.rda')
Train_prob_THR50_c3_model20 <- model20_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_model_I6_common <- model_I6_common %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_CTLA4 <- CTLA4_model_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_CTLA4_ICOS_CXCL13 <- CTLA4_ICOS_CXCL13_model_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_KLF7 <- KLF7_model_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_ZNF627 <- ZNF627_model_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_model20 <- model20_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_model_I6_common <- model_I6_common %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_model_THR56_I6 <- model_THR56_I6_common %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_model_THR56_I6 <- model_THR56_I6 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_model_THR56_I20 <- model_THR56_I20 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_CTLA4 <- CTLA4_model_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_CTLA4_ICOS_CXCL13 <- CTLA4_ICOS_CXCL13_model_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_KLF7 <- KLF7_model_c3 %>% predict(Data_c3 , type = "response")
Train_prob_THR50_c3_ZNF627 <- ZNF627_model_c3 %>% predict(Data_c3 , type = "response")
### Threshold
thr_THR50_c3_model20 <- coords(roc(RFS_c3, Train_prob_THR50_c3_model20, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_model_I6_common <- coords(roc(RFS_c3, Train_prob_THR50_c3_model_I6_common, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_model_THR56_I6_common <- coords(roc(RFS_c3, Train_prob_THR50_c3_model_THR56_I6_common, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_model_THR56_I6 <- coords(roc(RFS_c3, Train_prob_THR50_c3_model_THR56_I6, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_model_THR56_I6 <- coords(roc(RFS_c3, Train_prob_THR50_c3_model_THR56_I6, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_model_THR56_I20 <- coords(roc(RFS_c3, Train_prob_THR50_c3_model_THR56_I20, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_CTLA4 <- coords(roc(RFS_c3, Train_prob_THR50_c3_CTLA4, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_CTLA4_ICOS_CXCL13 <- coords(roc(RFS_c3, Train_prob_THR50_c3_CTLA4_ICOS_CXCL13, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_KLF7 <- coords(roc(RFS_c3, Train_prob_THR50_c3_KLF7, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
thr_THR50_c3_ZNF627 <- coords(roc(RFS_c3, Train_prob_THR50_c3_ZNF627, levels = c('longSurv', 'shortSurv'), direction = "<"), "best")["threshold"]
### ROC Curve
ROCTrain_THR50_c3_model20 <- roc(RFS_c3, Train_prob_THR50_c3_model20, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_model20
### ROC Curve
ROCTrain_THR50_c3_model_I6_common <- roc(RFS_c3, Train_prob_THR50_c3_model_I6_common, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_model_I6_common
### ROC Curve
ROCTrain_THR50_c3_model_THR56_I6 <- roc(RFS_c3, Train_prob_THR50_c3_model_THR56_I6, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_model_THR56_I6
### ROC Curve
ROCTrain_THR50_c3_model_THR56_I20 <- roc(RFS_c3, Train_prob_THR50_c3_model_THR56_I20, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_model_THR56_I20
### ROC Curve
ROCTrain_THR50_c3_CTLA4 <- roc(RFS_c3, Train_prob_THR50_c3_CTLA4, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_CTLA4
ROCTrain_THR50_c3_CTLA4_ICOS_CXCL13 <- roc(RFS_c3, Train_prob_THR50_c3_CTLA4_ICOS_CXCL13, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_CTLA4_ICOS_CXCL13
ROCTrain_THR50_c3_KLF7 <- roc(RFS_c3, Train_prob_THR50_c3_KLF7, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_KLF7
ROCTrain_THR50_c3_ZNF627 <- roc(RFS_c3, Train_prob_THR50_c3_ZNF627, plot = F, print.auc=TRUE, print.auc.col="black", ci = T, levels = c('longSurv', 'shortSurv'), direction = "<", col="blue", lwd=2, grid=TRUE)
ROCTrain_THR50_c3_ZNF627
### Get predictions based on best threshold from ROC curve
predClasses_THR50_c3_model20 <- ifelse(Train_prob_THR50_c3_model20 >= thr_THR50_c3_model20$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_model20)
predClasses_THR50_c3_model20 <- factor(predClasses_THR50_c3_model20, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_model_I6_common <- ifelse(Train_prob_THR50_c3_model_I6_common >= thr_THR50_c3_model_I6_common$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_model_I6_common)
predClasses_THR50_c3_model_I6_common <- factor(predClasses_THR50_c3_model_I6_common, levels = c('longSurv', 'shortSurv'))
### Get predictions based on best threshold from ROC curve
predClasses_THR50_c3_model20 <- ifelse(Train_prob_THR50_c3_model20 >= thr_THR50_c3_model20$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_model20)
predClasses_THR50_c3_model20 <- factor(predClasses_THR50_c3_model20, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_model_I6_common <- ifelse(Train_prob_THR50_c3_model_I6_common >= thr_THR50_c3_model_I6_common$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_model_I6_common)
predClasses_THR50_c3_model_I6_common <- factor(predClasses_THR50_c3_model_I6_common, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_model_THR56_I6 <- ifelse(Train_prob_THR50_c3_model_THR56_I6 >= thr_THR50_c3_model_THR56_I6$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_model_THR56_I6)
predClasses_THR50_c3_model_THR56_I6 <- factor(predClasses_THR50_c3_model_THR56_I6, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_model_THR56_I20 <- ifelse(Train_prob_THR50_c3_model_THR56_I20 >= thr_THR50_c3_model_THR56_I20$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_model_THR56_I20)
predClasses_THR50_c3_model_THR56_I20 <- factor(predClasses_THR50_c3_model_THR56_I20, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_CTLA4 <- ifelse(Train_prob_THR50_c3_CTLA4 >= thr_THR50_c3_CTLA4$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_CTLA4)
predClasses_THR50_c3_CTLA4 <- factor(predClasses_THR50_c3_CTLA4, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_CTLA4_ICOS_CXCL13 <- ifelse(Train_prob_THR50_c3_CTLA4_ICOS_CXCL13 >= thr_THR50_c3_CTLA4_ICOS_CXCL13$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_CTLA4_ICOS_CXCL13)
predClasses_THR50_c3_CTLA4_ICOS_CXCL13 <- factor(predClasses_THR50_c3_CTLA4_ICOS_CXCL13, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_KLF7 <- ifelse(Train_prob_THR50_c3_KLF7 >= thr_THR50_c3_KLF7$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_KLF7)
predClasses_THR50_c3_KLF7 <- factor(predClasses_THR50_c3_KLF7, levels = c('longSurv', 'shortSurv'))
predClasses_THR50_c3_ZNF627 <- ifelse(Train_prob_THR50_c3_ZNF627 >= thr_THR50_c3_ZNF627$threshold, "longSurv", "shortSurv")
table(predClasses_THR50_c3_ZNF627)
predClasses_THR50_c3_ZNF627 <- factor(predClasses_THR50_c3_ZNF627, levels = c('longSurv', 'shortSurv'))
#############
##########################
## Keep only the relevant information (Metastasis Event and Time)
cluster3_pheno <- cbind(cluster3_pheno[, c("Overall.Survival.Status", "Overall.Survival..Months.", "Relapse.Free.Status", "Relapse.Free.Status..Months.", "Pam50...Claudin.low.subtype", "ER.status.measured.by.IHC", "X3.Gene.classifier.subtype")],
Train_prob_THR50_c3_model20, predClasses_THR50_c3_model20,
Train_prob_THR50_c3_model_I6_common, predClasses_THR50_c3_model_I6_common,
Train_prob_THR50_c3_model_THR56_I6, predClasses_THR50_c3_model_THR56_I6,
Train_prob_THR50_c3_model_THR56_I20, predClasses_THR50_c3_model_THR56_I20,
Train_prob_THR50_c3_CTLA4, predClasses_THR50_c3_CTLA4,
Train_prob_THR50_c3_CTLA4_ICOS_CXCL13, predClasses_THR50_c3_CTLA4_ICOS_CXCL13,
Train_prob_THR50_c3_KLF7, predClasses_THR50_c3_KLF7,
Train_prob_THR50_c3_ZNF627, predClasses_THR50_c3_ZNF627
)
CoxData_metabric_c3 <- data.frame(cluster3_pheno)
# OS
Fit_sig_metabric_os_THR50_c3_model20 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ predClasses_THR50_c3_model20, data = CoxData_metabric_c3)
# RFS
Fit_sig_metabric_RFS_THR50_c3_model20 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ predClasses_THR50_c3_model20, data = CoxData_metabric_c3)
# OS
Fit_sig_metabric_os_THR50_c3_model_I6_common <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ predClasses_THR50_c3_model_I6_common, data = CoxData_metabric_c3)
# RFS
Fit_sig_metabric_RFS_THR50_c3_model_I6_common <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ predClasses_THR50_c3_model_I6_common, data = CoxData_metabric_c3)
ggsurvplot(Fit_sig_metabric_os_THR50_c3_model_I6_common,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
palette = 'jco',
risk.table.y.text = FALSE,
title = 'OS in METABRIC in T1 class derived from THR50: I6'
)
# OS
Fit_sig_metabric_os_THR50_c3_model_THR56_I6 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ predClasses_THR50_c3_model_THR56_I6, data = CoxData_metabric_c3)
# RFS
Fit_sig_metabric_RFS_THR50_c3_model_THR56_I6 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ predClasses_THR50_c3_model_THR56_I6, data = CoxData_metabric_c3)
ggsurvplot(Fit_sig_metabric_os_THR50_c3_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
palette = 'jco',
risk.table.y.text = FALSE,
title = 'OS in METABRIC in T1 class derived from THR50: THR56 and I6'
)
ggsurvplot(Fit_sig_metabric_RFS_THR50_c3_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE,
palette = 'jco',
title = 'RFS in METABRIC in T1 class derived from THR50: THR56 and I6'
)
# plot OS
tiff("./figures/c3_DE_THR50_RFS/THR50_metabric_os_c3_model_THR56_I6.tiff", width = 3000, height = 3000, res = 300)
ggsurvplot(Fit_sig_metabric_os_THR50_c3_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
palette = 'jco',
risk.table.y.text = FALSE,
title = 'OS in METABRIC in T1 class derived from THR50: THR56 and I6'
)
dev.off()
######################################
# plot RFS
tiff("./figures/c3_DE_THR50_RFS/THR50_metabric_rfs_c3_model_THR56_I6.tiff", width = 3000, height = 3000, res = 300)
ggsurvplot(Fit_sig_metabric_RFS_THR50_c3_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE,
palette = 'jco',
title = 'RFS in METABRIC in T1 class derived from THR50: THR56 and I6'
)
dev.off()
# OS
Fit_sig_metabric_os_THR50_c3_model_THR56_I20 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ predClasses_THR50_c3_model_THR56_I20, data = CoxData_metabric_c3)
# RFS
Fit_sig_metabric_RFS_THR50_c3_model_THR56_I20 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ predClasses_THR50_c3_model_THR56_I20, data = CoxData_metabric_c3)
# OS
Fit_sig_metabric_os_THR50_c3_model_THR56_I20 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ predClasses_THR50_c3_model_THR56_I20, data = CoxData_metabric_c3)
# RFS
Fit_sig_metabric_RFS_THR50_c3_model_THR56_I20 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ predClasses_THR50_c3_model_THR56_I20, data = CoxData_metabric_c3)
# plot OS
tiff("./figures/c3_DE_THR50_RFS/THR50_metabric_os_c3_model_THR56_I20.tiff", width = 3000, height = 3000, res = 300)
ggsurvplot(Fit_sig_metabric_os_THR50_c3_model_THR56_I20,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
palette = 'jco',
risk.table.y.text = FALSE,
title = 'OS in METABRIC in T1 class derived from THR50: THR56 and I20'
)
dev.off()
# plot OS
tiff("./figures/c3_DE_THR50_RFS/THR50_metabric_os_c3_model_THR56_I20.tiff", width = 3000, height = 3000, res = 300)
ggsurvplot(Fit_sig_metabric_os_THR50_c3_model_THR56_I20,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
palette = 'jco',
risk.table.y.text = FALSE,
title = 'OS in METABRIC in T1 class derived from THR50: THR56 and I20'
)
dev.off()
######################################
# plot RFS
tiff("./figures/c3_DE_THR50_RFS/THR50_metabric_rfs_c3_model_THR56_I20.tiff", width = 3000, height = 3000, res = 300)
ggsurvplot(Fit_sig_metabric_RFS_THR50_c3_model_THR56_I20,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE,
palette = 'jco',
title = 'RFS in METABRIC in T1 class derived from THR50: THR56 and I20'
)
dev.off()
# OS
Fit_sig_metabric_os_THR50_c3_CTLA4 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ predClasses_THR50_c3_CTLA4, data = CoxData_metabric_c3)
# RFS
Fit_sig_metabric_RFS_THR50_c3_CTLA4 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ predClasses_THR50_c3_CTLA4, data = CoxData_metabric_c3)
# plot OS
tiff("./figures/c3_DE_THR50_RFS/THR50_metabric_os_c3_CTLA4.tiff", width = 3000, height = 3000, res = 300)
ggsurvplot(Fit_sig_metabric_os_THR50_c3_CTLA4,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
palette = 'jco',
risk.table.y.text = FALSE,
title = 'OS in METABRIC in T1 class derived from THR50: CTLA4'
)
dev.off()
######################################
# plot RFS
tiff("./figures/c3_DE_THR50_RFS/THR50_metabric_RFS_c3_CTLA4.tiff", width = 3000, height = 3000, res = 300)
ggsurvplot(Fit_sig_metabric_RFS_THR50_c3_CTLA4,
risk.table = FALSE,
pval = TRUE,
legend.labs = c('prediction: 0', 'prediction: 1'),
ggtheme = theme_survminer(base_size = 30, font.x = c(30, 'bold.italic', 'black'), font.y = c(30, 'bold.italic', 'black'), font.tickslab = c(30, 'plain', 'black'), font.legend = c(30, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE,
palette = 'jco',
title = 'RFS in METABRIC in T1 class derived from THR50: CTLA4'
)
dev.off()
##########################################################################################
##########################################################################################
## recombine c3 with the rest
cluster3_pheno$THR_clusters_model20 <- as.factor(cluster3_pheno$predClasses_THR50_c3_model20)
levels(cluster3_pheno$THR_clusters_model20) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_model_I6_common <- as.factor(cluster3_pheno$predClasses_THR50_c3_model_I6_common)
levels(cluster3_pheno$THR_clusters_model_I6_common) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_model_I6_common <- as.factor(cluster3_pheno$predClasses_THR50_c3_model_I6_common)
levels(cluster3_pheno$THR_clusters_model_I6_common) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_model_THR56_I6 <- as.factor(cluster3_pheno$predClasses_THR50_c3_model_THR56_I6)
levels(cluster3_pheno$THR_clusters_model_THR56_I6) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_model_THR56_I20 <- as.factor(cluster3_pheno$predClasses_THR50_c3_model_THR56_I20)
levels(cluster3_pheno$THR_clusters_model_THR56_I20) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_CTLA4 <- as.factor(cluster3_pheno$predClasses_THR50_c3_CTLA4)
levels(cluster3_pheno$THR_clusters_CTLA4) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_CTLA4_ICOS_CXCL13 <- as.factor(cluster3_pheno$predClasses_THR50_c3_CTLA4_ICOS_CXCL13)
levels(cluster3_pheno$THR_clusters_CTLA4_ICOS_CXCL13) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_KLF7 <- as.factor(cluster3_pheno$predClasses_THR50_c3_KLF7)
levels(cluster3_pheno$THR_clusters_KLF7) <- c('3_1', '3_2')
cluster3_pheno$THR_clusters_ZNF627 <- as.factor(cluster3_pheno$predClasses_THR50_c3_ZNF627)
levels(cluster3_pheno$THR_clusters_ZNF627) <- c('3_1', '3_2')
c3 <- data.frame(THR_clusters_model20 = cluster3_pheno$THR_clusters_model20,
THR_clusters_model_I6 = cluster3_pheno$THR_clusters_model_I6_common,
THR_clusters_model_THR56_I6 = cluster3_pheno$THR_clusters_model_THR56_I6,
THR_clusters_model_THR56_I20 = cluster3_pheno$THR_clusters_model_THR56_I20,
THR_clusters_CTLA4 = cluster3_pheno$THR_clusters_CTLA4,
THR_clusters_CTLA4_ICOS_CXCL13 = cluster3_pheno$THR_clusters_CTLA4_ICOS_CXCL13,
THR_clusters_KLF7 = cluster3_pheno$THR_clusters_KLF7,
THR_clusters_ZNF627 = cluster3_pheno$THR_clusters_ZNF627,
`Sample.ID` = rownames(cluster3_pheno))
rownames(c3) <- rownames(cluster3_pheno)
# merge
Pheno_metabric$`THR clusters`[Pheno_metabric$`THR clusters` == '3'] <- NA
Pheno_metabric2 <- merge(x = c3, y = Pheno_metabric, by="Sample.ID", all.y = TRUE)
Pheno_metabric2 <- Pheno_metabric2 %>%
mutate(`THR clusters` = as.factor(`THR clusters`), THR_clusters_model20 = as.factor(THR_clusters_model20)) %>%
mutate(THR.clusters_model20Merged = coalesce(THR_clusters_model20,`THR clusters`)) %>%
mutate(THR.clusters_model_I6_Merged = coalesce(THR_clusters_model_I6,`THR clusters`)) %>%
mutate(THR.clusters_model_THR56_I6_Merged = coalesce(THR_clusters_model_THR56_I6,`THR clusters`)) %>%
mutate(THR.clusters_model_THR56_I20_Merged = coalesce(THR.clusters_model_THR56_I20,`THR clusters`)) %>%
mutate(THR.clusters_CTLA4Merged = coalesce(THR_clusters_CTLA4,`THR clusters`)) %>%
mutate(THR.clusters_CTLA4_ICOS_CXCL13Merged = coalesce(THR_clusters_CTLA4_ICOS_CXCL13,`THR clusters`)) %>%
mutate(THR.clusters_KLF7Merged = coalesce(THR_clusters_KLF7,`THR clusters`)) %>%
mutate(THR.clusters_ZNF627Merged = coalesce(THR_clusters_ZNF627,`THR clusters`))
Pheno_metabric2 <- Pheno_metabric2 %>%
mutate(`THR clusters` = as.factor(`THR clusters`), THR_clusters_model20 = as.factor(THR_clusters_model20)) %>%
mutate(THR.clusters_model20Merged = coalesce(THR_clusters_model20,`THR clusters`)) %>%
mutate(THR.clusters_model_I6_Merged = coalesce(THR_clusters_model_I6,`THR clusters`)) %>%
mutate(THR.clusters_model_THR56_I6_Merged = coalesce(THR_clusters_model_THR56_I6,`THR clusters`)) %>%
mutate(THR.clusters_model_THR56_I20_Merged = coalesce(THR_clusters_model_THR56_I20,`THR clusters`)) %>%
mutate(THR.clusters_CTLA4Merged = coalesce(THR_clusters_CTLA4,`THR clusters`)) %>%
mutate(THR.clusters_CTLA4_ICOS_CXCL13Merged = coalesce(THR_clusters_CTLA4_ICOS_CXCL13,`THR clusters`)) %>%
mutate(THR.clusters_KLF7Merged = coalesce(THR_clusters_KLF7,`THR clusters`)) %>%
mutate(THR.clusters_ZNF627Merged = coalesce(THR_clusters_ZNF627,`THR clusters`))
Pheno_metabric2 <- Pheno_metabric2 %>%
mutate(`THR clusters` = as.factor(`THR clusters`), THR_clusters_model20 = as.factor(THR_clusters_model20)) %>%
mutate(THR.clusters_model20Merged = coalesce(THR_clusters_model20,`THR clusters`)) %>%
mutate(THR.clusters_model_I6_Merged = coalesce(THR_clusters_model_I6,`THR clusters`)) %>%
mutate(THR.clusters_model_THR56_I6_Merged = coalesce(THR_clusters_model_THR56_I6,`THR clusters`)) %>%
mutate(THR.clusters_model_THR56_I20_Merged = coalesce(THR_clusters_model_THR56_I20,`THR clusters`)) %>%
mutate(THR.clusters_CTLA4Merged = coalesce(THR_clusters_CTLA4,`THR clusters`)) %>%
mutate(THR.clusters_CTLA4_ICOS_CXCL13Merged = coalesce(THR_clusters_CTLA4_ICOS_CXCL13,`THR clusters`)) %>%
mutate(THR.clusters_KLF7Merged = coalesce(THR_clusters_KLF7,`THR clusters`)) %>%
mutate(THR.clusters_ZNF627Merged = coalesce(THR_clusters_ZNF627,`THR clusters`))
## Keep only the relevant information (Metastasis Event and Time)
survival_metabric <- Pheno_metabric2[, c("Overall.Survival.Status", "Overall.Survival..Months.",
"Relapse.Free.Status", "Relapse.Free.Status..Months.",
"Pam50...Claudin.low.subtype", "ER.status.measured.by.IHC",
"X3.Gene.classifier.subtype",
"THR.clusters_model20Merged",
"THR.clusters_model_I6_Merged",
"THR.clusters_model_THR56_I6_Merged",
"THR.clusters_model_THR56_I20_Merged",
'THR.clusters_CTLA4Merged',
'THR.clusters_CTLA4_ICOS_CXCL13Merged',
'THR.clusters_KLF7Merged',
'THR.clusters_ZNF627Merged'
)]
survival_metabric$THR.clusters_model20Merged <- as.factor(survival_metabric$THR.clusters_model20Merged)
survival_metabric$THR.clusters_model_I6_Merged <- as.factor(survival_metabric$THR.clusters_model_I6_Merged)
survival_metabric$THR.clusters_model_THR56_I6_Merged <- as.factor(survival_metabric$THR.clusters_model_THR56_I6_Merged)
survival_metabric$THR.clusters_model_THR56_I20_Merged <- as.factor(survival_metabric$THR.clusters_model_THR56_I20_Merged)
survival_metabric$THR.clusters_CTLA4Merged <- as.factor(survival_metabric$THR.clusters_CTLA4Merged)
survival_metabric$THR.clusters_CTLA4_ICOS_CXCL13Merged <- as.factor(survival_metabric$THR.clusters_CTLA4_ICOS_CXCL13Merged)
survival_metabric$THR.clusters_KLF7Merged <- as.factor(survival_metabric$THR.clusters_KLF7Merged)
survival_metabric$THR.clusters_ZNF627Merged <- as.factor(survival_metabric$THR.clusters_ZNF627Merged)
levels(survival_metabric$THR.clusters_model20Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_model_I6_Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_model20Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_model_I6_Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_model_THR56_I6_Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_model_THR56_I20_Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_CTLA4Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_CTLA4_ICOS_CXCL13Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_KLF7Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
levels(survival_metabric$THR.clusters_ZNF627Merged) <- c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2')
# OS
Fit_metabric_os_model20 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ THR.clusters_model20Merged, data = survival_metabric)
# RFS
Fit_metabric_RFS_model20 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ THR.clusters_model20Merged, data = survival_metabric)
# OS
Fit_metabric_os_model_I6 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ THR.clusters_model_I6_Merged, data = survival_metabric)
# RFS
Fit_metabric_RFS_model_I6 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ THR.clusters_model_I6_Merged, data = survival_metabric)
# OS
Fit_metabric_os_model_I6 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ THR.clusters_model_I6_Merged, data = survival_metabric)
# RFS
Fit_metabric_RFS_model_I6 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ THR.clusters_model_I6_Merged, data = survival_metabric)
# OS
Fit_metabric_os_model_THR56_I6 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ THR.clusters_model_THR56_I6_Merged, data = survival_metabric)
# RFS
Fit_metabric_RFS_model_THR56_I6 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ THR.clusters_model_THR56_I6_Merged, data = survival_metabric)
ggsurvplot(Fit_metabric_os_model_I6,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'Ta_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and OS: THR50 + I20')
pdf("./figures/c3_DE_THR50_RFS/metabric_os_5clusters_model_I6_Merged.pdf", width = 10, height = 8, onefile = F)
ggsurvplot(Fit_metabric_os_model_I6,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'Ta_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and OS: THR50 + I6')
dev.off()
pdf("./figures/c3_DE_THR50_RFS/metabric_rfs_5clusters_model_I6_Merged.pdf", width = 10, height = 8, onefile = F)
ggsurvplot(Fit_metabric_RFS_model_I6,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and RFS: THR50 + I6')
dev.off()
# OS
Fit_metabric_os_model_THR56_I6 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ THR.clusters_model_THR56_I6_Merged, data = survival_metabric)
# RFS
Fit_metabric_RFS_model_THR56_I6 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ THR.clusters_model_THR56_I6_Merged, data = survival_metabric)
ggsurvplot(Fit_metabric_os_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'Ta_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and OS: THR56 + I6')
ggsurvplot(Fit_metabric_RFS_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and RFS: THR56 + I6')
pdf("./figures/c3_DE_THR50_RFS/metabric_rfs_5clusters_model_THR56_I6_Merged.pdf", width = 10, height = 8, onefile = F)
ggsurvplot(Fit_metabric_RFS_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and RFS: THR56 + I6')
dev.off()
pdf("./figures/c3_DE_THR50_RFS/metabric_os_5clusters_model_THR56_I6_Merged.pdf", width = 10, height = 8, onefile = F)
ggsurvplot(Fit_metabric_os_model_THR56_I6,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'Ta_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and OS: THR56 + I6')
dev.off()
table(survival_metabric$THR.clusters_model_THR56_I6_Merged, survival_metabric$THR.clusters_model_I6_Merged)
table(survival_metabric$THR.clusters_model_THR56_I6_Merged, survival_metabric$THR.clusters_model20Merged)
# OS
Fit_metabric_os_model_THR56_I20 <- survfit(Surv(Overall.Survival..Months., Overall.Survival.Status) ~ THR.clusters_model_THR56_I20_Merged, data = survival_metabric)
# RFS
Fit_metabric_RFS_model_THR56_I20 <- survfit(Surv(Relapse.Free.Status..Months., Relapse.Free.Status) ~ THR.clusters_model_THR56_I20_Merged, data = survival_metabric)
pdf("./figures/c3_DE_THR50_RFS/metabric_os_5clusters_model_THR56_I20_Merged.pdf", width = 10, height = 8, onefile = F)
ggsurvplot(Fit_metabric_os_model_THR56_I20,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'Ta_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and OS: THR56 + I20')
dev.off()
pdf("./figures/c3_DE_THR50_RFS/metabric_rfs_5clusters_model_THR56_I20_Merged.pdf", width = 10, height = 8, onefile = F)
ggsurvplot(Fit_metabric_RFS_model_THR56_I20,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and RFS: THR56 + I20')
dev.off()
ggsurvplot(Fit_metabric_os_model_THR56_I20,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'Ta_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and OS: THR56 + I20')
ggsurvplot(Fit_metabric_RFS_model_THR56_I20,
risk.table = FALSE,
pval = TRUE,
#palette = cluster_colors,
#xlim = c(0,120),
legend.labs = c('T1_a', 'T1_b', 'E3', 'E1', 'E4', 'E2'),
legend.title	= 'THR clusters',
pval.size = 12,
#break.x.by = 20,
ggtheme = theme_survminer(base_size = 18, font.x = c(18, 'bold.italic', 'black'), font.y = c(18, 'bold.italic', 'black'), font.tickslab = c(18, 'plain', 'black'), font.legend = c(18, 'bold', 'black')),
risk.table.y.text.col = FALSE,
risk.table.y.text = FALSE, title = 'THR50 clusters and RFS: THR56 + I20')
